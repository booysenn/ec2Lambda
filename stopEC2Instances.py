#!/usr/bin/env python#title           :stopEC2Instances.py#description     :AWS Lambda python script to stop instances in all regions with "LambdaStop" tag set to "true"#author          :booysenn#date            :20160915#version         :0.1#usage           :copy to Lambda function. Can trigger with Cloudwatch schedule#notes           :Execution time 13 seconds#==============================================================================import boto3def lambda_handler(event, context):    ec2 = boto3.client('ec2')    regions = ec2.describe_regions()    for region in regions['Regions']:        ec2 = boto3.client('ec2', region_name=region['RegionName'])        response = ec2.describe_instances( Filters=[{'Name':'tag:LambdaStop', 'Values':['true']}])        instances = []        for res in response['Reservations']:            for inst in res['Instances']:                instances.append(inst['InstanceId'])                ec2.stop_instances(InstanceIds=instances)